{"version":3,"sources":["webpack:///./src/components/ShotDetection.vue?9470","webpack:///src/components/ShotDetection.vue","webpack:///./src/components/ShotDetection.vue?81c0","webpack:///./src/components/ShotDetection.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","elasticsearch_data","perPage","currentPage","fields","sortBy","scopedSlots","_u","key","fn","data","on","$event","setPlayerTime","item","EndTimestamp","StartTimestamp","_v","_s","Index","rows","model","value","callback","$$v","expression","saveFile","showElasticsearchApiRequest","directives","name","rawName","ELASTICSEARCH_ENDPOINT","JSON","stringify","searchQuery","staticRenderFns","components","Loading","props","mediaType","type","String","default","curlCommand","endTimestamp","label","sortable","isBusy","operator","computed","_objectSpread","mapState","length","watch","current_time","time","player","pause","deactivated","console","log","activated","fetchAssetData","mounted","getCurlCommand","beforeDestroy","methods","endMillisenconds","startMilliseconds","seconds","currentTime","play","$route","params","asset_id","AWS_REGION","encodeURIComponent","blob","Blob","e","document","createEvent","a","createElement","download","href","window","URL","createObjectURL","dataset","downloadurl","join","initEvent","dispatchEvent","_this","_asyncToGenerator","_regenerator","m","_callee","apiName","path","apiParams","response","es_data","result","i","len","w","_context","n","headers","queryStringParameters","$Amplify","API","get","v","showElasticSearchAlert","hits","Confidence","lowerConfidence","lowerConfidenceMessage","push","_source","parse","component"],"mappings":"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","file":"js/chunk-2d2302c3.9a781fb8.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[(_vm.isBusy)?_c('div',{staticClass:\"wrapper\"},[_c('Loading')],1):_c('div',{staticClass:\"wrapper\"},[_c('b-table',{attrs:{\"id\":\"shotTable\",\"responsive\":\"\",\"fixed\":\"\",\"items\":_vm.elasticsearch_data,\"per-page\":_vm.perPage,\"current-page\":_vm.currentPage,\"fields\":_vm.fields,\"sort-by\":_vm.sortBy},scopedSlots:_vm._u([{key:\"cell(Index)\",fn:function(data){return [_c('b-button',{attrs:{\"variant\":\"link\"},on:{\"click\":function($event){return _vm.setPlayerTime(data.item.EndTimestamp, data.item.StartTimestamp)}}},[_vm._v(\"\\n          \"+_vm._s(data.item.Index)+\"\\n        \")])]}}])}),_c('b-pagination',{attrs:{\"align\":\"center\",\"per-page\":_vm.perPage,\"total-rows\":_vm.rows,\"aria-controls\":\"shotTable\"},model:{value:(_vm.currentPage),callback:function ($$v) {_vm.currentPage=$$v},expression:\"currentPage\"}}),_c('b-button',{attrs:{\"type\":\"button\"},on:{\"click\":function($event){return _vm.saveFile()}}},[_vm._v(\"\\n      Download Data\\n    \")]),_c('br'),_c('b-button',{staticClass:\"text-decoration-none\",attrs:{\"pressed\":false,\"size\":\"sm\",\"variant\":\"link\"},on:{\"click\":function($event){_vm.showElasticsearchApiRequest = true}}},[_vm._v(\"\\n      Show API request to get these results\\n    \")]),_c('b-modal',{attrs:{\"scrollable\":\"\",\"title\":\"SEARCH API\",\"ok-only\":\"\"},model:{value:(_vm.showElasticsearchApiRequest),callback:function ($$v) {_vm.showElasticsearchApiRequest=$$v},expression:\"showElasticsearchApiRequest\"}},[_c('label',[_vm._v(\"Request URL:\")]),_c('pre',{directives:[{name:\"highlightjs\",rawName:\"v-highlightjs\"}]},[_c('code',{staticClass:\"bash\"},[_vm._v(\"GET \"+_vm._s(_vm.ELASTICSEARCH_ENDPOINT)+\"workflow/execution\")])]),_c('label',[_vm._v(\"Search query:\")]),_c('pre',{directives:[{name:\"highlightjs\",rawName:\"v-highlightjs\",value:(JSON.stringify(_vm.searchQuery)),expression:\"JSON.stringify(searchQuery)\"}]},[_c('code',{staticClass:\"json\"})]),_c('label',[_vm._v(\"Sample command:\")]),_c('pre',{directives:[{name:\"highlightjs\",rawName:\"v-highlightjs\",value:(_vm.curlCommand),expression:\"curlCommand\"}]},[_c('code',{staticClass:\"bash\"})])])],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div>\n    <div\n      v-if=\"isBusy\"\n      class=\"wrapper\"\n    >\n      <Loading />\n    </div>\n    <div\n      v-else\n      class=\"wrapper\"\n    >\n      <b-table\n        id=\"shotTable\"\n        responsive\n        fixed\n        :items=\"elasticsearch_data\"\n        :per-page=\"perPage\"\n        :current-page=\"currentPage\"\n        :fields=\"fields\"\n        :sort-by=\"sortBy\"\n      >\n        <template #cell(Index)=\"data\">\n          <b-button variant=\"link\" @click=\"setPlayerTime(data.item.EndTimestamp, data.item.StartTimestamp)\">\n            {{ data.item.Index }}\n          </b-button>\n        </template>\n      </b-table>\n      <b-pagination\n        v-model=\"currentPage\"\n        align=\"center\"\n        :per-page=\"perPage\"\n        :total-rows=\"rows\"\n        aria-controls=\"shotTable\"\n      ></b-pagination>\n      <b-button\n        type=\"button\"\n        @click=\"saveFile()\"\n      >\n        Download Data\n      </b-button>\n      <br>\n      <b-button\n          :pressed=\"false\"\n          size=\"sm\"\n          variant=\"link\"\n          class=\"text-decoration-none\"\n          @click=\"showElasticsearchApiRequest = true\"\n      >\n        Show API request to get these results\n      </b-button>\n      <b-modal\n          v-model=\"showElasticsearchApiRequest\"\n          scrollable\n          title=\"SEARCH API\"\n          ok-only\n      >\n        <label>Request URL:</label>\n        <pre v-highlightjs><code class=\"bash\">GET {{ ELASTICSEARCH_ENDPOINT }}workflow/execution</code></pre>\n        <label>Search query:</label>\n        <pre v-highlightjs=\"JSON.stringify(searchQuery)\"><code class=\"json\"></code></pre>\n        <label>Sample command:</label>\n        <pre v-highlightjs=\"curlCommand\"><code class=\"bash\"></code></pre>\n      </b-modal>\n    </div>\n  </div>\n</template>\n\n<script>\n  import Loading from '@/components/Loading.vue'\n  import { mapState } from 'vuex'\n  export default {\n    name: \"ShotDetection\",\n    components: {\n      Loading\n    },\n    props: {\n      mediaType: {\n        type: String,\n        default: \"\"\n      },\n    },\n    data() {\n      return {\n        curlCommand: '',\n        searchQuery: '',\n        showElasticsearchApiRequest: false,\n        sortBy: 'Index',\n        currentPage: 1,\n        perPage: 10,\n        endTimestamp: null,\n        fields: [\n          {\n            'Index': {\n              label: 'Shot Number',\n              sortable: true\n            }\n          },\n          {\n            'StartTimecodeSMPTE': {\n              label: 'Start',\n              sortable: false\n            }\n          },\n          {\n            'EndTimecodeSMPTE': {\n              label: 'End',\n              sortable: false\n              }\n          },\n          {\n            'DurationSMPTE': {\n              label: 'Duration',\n              sortable: true\n              }\n          },\n          { key: 'Confidence', sortable: true }\n      ],\n        elasticsearch_data: [],\n        isBusy: false,\n        operator: 'shot_detection',\n      }\n    },\n    computed: {\n      ...mapState(['player']),\n      ...mapState(['current_time']),\n      rows() {\n        return this.elasticsearch_data.length\n      },\n    },\n    watch: {\n      current_time(time) {\n        if (this.endTimestamp != null) {\n          if (time == this.endTimestamp || time > this.endTimestamp) {\n            this.player.pause();\n            this.endTimestamp = null\n          }\n        }\n      }\n    },\n    deactivated: function () {\n      console.log('deactivated component:', this.operator);\n    },\n    activated: function () {\n      console.log('activated component:', this.operator)\n      this.fetchAssetData();\n    },\n    mounted: function() {\n      this.getCurlCommand();\n    },\n    beforeDestroy: function () {\n      this.elasticsearch_data = [];\n    },\n    methods: {\n      setPlayerTime(endMillisenconds, startMilliseconds) {\n        this.endTimestamp = endMillisenconds / 1000\n        let seconds = startMilliseconds / 1000\n        this.player.currentTime(seconds)\n        this.player.play();\n      },\n      getCurlCommand() {\n        this.searchQuery = 'AssetId:'+this.$route.params.asset_id+' Operator:'+this.operator;\n        // get curl command to search elasticsearch\n        this.curlCommand = 'awscurl -X GET --profile default --service es --region ' + this.AWS_REGION + ' \\'' + this.ELASTICSEARCH_ENDPOINT + '/_search?q=' + encodeURIComponent(this.searchQuery) + '\\''\n      },\n      saveFile() {\n        const elasticsearch_data = JSON.stringify(this.elasticsearch_data);\n        const blob = new Blob([elasticsearch_data], {type: 'text/plain'});\n        const e = document.createEvent('MouseEvents'),\n          a = document.createElement('a');\n        a.download = \"data.json\";\n        a.href = window.URL.createObjectURL(blob);\n        a.dataset.downloadurl = ['text/json', a.download, a.href].join(':');\n        e.initEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n        a.dispatchEvent(e);\n      },\n      async fetchAssetData () {\n          let query = 'AssetId:'+this.$route.params.asset_id+' Operator:'+this.operator;\n          let apiName = 'contentAnalysisElasticsearch';\n          let path = '/_search';\n          let apiParams = {\n            headers: {'Content-Type': 'application/json'},\n            queryStringParameters: {'q': this.searchQuery, 'default_operator': 'AND', 'size': 10000}\n          };\n          let response = await this.$Amplify.API.get(apiName, path, apiParams);\n          console.log(response)\n          if (!response) {\n            this.showElasticSearchAlert = true\n          }\n          else {\n            let es_data = [];\n            let result = await response;\n            let data = result.hits.hits;\n            if (data.length === 0 && this.Confidence > 55) {\n                this.lowerConfidence = true;\n                this.lowerConfidenceMessage = 'Try lowering confidence threshold'\n            }\n            else {\n              this.lowerConfidence = false;\n              for (let i = 0, len = data.length; i < len; i++) {\n                es_data.push(data[i]._source)\n              }\n            }\n            this.elasticsearch_data = JSON.parse(JSON.stringify(es_data));\n            this.isBusy = false\n        }\n      }\n    }\n  }\n</script>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ShotDetection.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ShotDetection.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./ShotDetection.vue?vue&type=template&id=ac80c75a\"\nimport script from \"./ShotDetection.vue?vue&type=script&lang=js\"\nexport * from \"./ShotDetection.vue?vue&type=script&lang=js\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}