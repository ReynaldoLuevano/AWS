(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1d10fd4a"],{"04d1":function(e,t,n){var i=n("342f"),a=i.match(/firefox\/(\d+)/i);e.exports=!!a&&+a[1]},2909:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n("6b75");function a(e){if(Array.isArray(e))return Object(i["a"])(e)}n("a4d3"),n("e01a"),n("d28b"),n("a630"),n("d3b7"),n("3ca3"),n("ddb0");function r(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var s=n("06c5");function o(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e){return a(e)||r(e)||Object(s["a"])(e)||o()}},"4e82":function(e,t,n){"use strict";var i=n("23e7"),a=n("1c0b"),r=n("7b0b"),s=n("50c4"),o=n("d039"),c=n("addb"),l=n("a640"),d=n("04d1"),u=n("d998"),h=n("2d00"),f=n("512c"),v=[],p=v.sort,b=o((function(){v.sort(void 0)})),m=o((function(){v.sort(null)})),g=l("sort"),y=!o((function(){if(h)return h<70;if(!(d&&d>3)){if(u)return!0;if(f)return f<603;var e,t,n,i,a="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)v.push({k:t+i,v:n})}for(v.sort((function(e,t){return t.v-e.v})),i=0;i<v.length;i++)t=v[i].k.charAt(0),a.charAt(a.length-1)!==t&&(a+=t);return"DGBEFHACIJK"!==a}})),x=b||!m||!g||!y,w=function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:String(t)>String(n)?1:-1}};i({target:"Array",proto:!0,forced:x},{sort:function(e){void 0!==e&&a(e);var t=r(this);if(y)return void 0===e?p.call(t):p.call(t,e);var n,i,o=[],l=s(t.length);for(i=0;i<l;i++)i in t&&o.push(t[i]);o=c(o,w(e)),n=o.length,i=0;while(i<n)t[i]=o[i++];while(i<l)delete t[i++];return t}})},"4ec9":function(e,t,n){"use strict";var i=n("6d61"),a=n("6566");e.exports=i("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),a)},"512c":function(e,t,n){var i=n("342f"),a=i.match(/AppleWebKit\/(\d+)\./);e.exports=!!a&&+a[1]},6566:function(e,t,n){"use strict";var i=n("9bf2").f,a=n("7c73"),r=n("e2cc"),s=n("0366"),o=n("19aa"),c=n("2266"),l=n("7dd0"),d=n("2626"),u=n("83ab"),h=n("f183").fastKey,f=n("69f3"),v=f.set,p=f.getterFor;e.exports={getConstructor:function(e,t,n,l){var d=e((function(e,i){o(e,d,t),v(e,{type:t,index:a(null),first:void 0,last:void 0,size:0}),u||(e.size=0),void 0!=i&&c(i,e[l],{that:e,AS_ENTRIES:n})})),f=p(t),b=function(e,t,n){var i,a,r=f(e),s=m(e,t);return s?s.value=n:(r.last=s={index:a=h(t,!0),key:t,value:n,previous:i=r.last,next:void 0,removed:!1},r.first||(r.first=s),i&&(i.next=s),u?r.size++:e.size++,"F"!==a&&(r.index[a]=s)),e},m=function(e,t){var n,i=f(e),a=h(t);if("F"!==a)return i.index[a];for(n=i.first;n;n=n.next)if(n.key==t)return n};return r(d.prototype,{clear:function(){var e=this,t=f(e),n=t.index,i=t.first;while(i)i.removed=!0,i.previous&&(i.previous=i.previous.next=void 0),delete n[i.index],i=i.next;t.first=t.last=void 0,u?t.size=0:e.size=0},delete:function(e){var t=this,n=f(t),i=m(t,e);if(i){var a=i.next,r=i.previous;delete n.index[i.index],i.removed=!0,r&&(r.next=a),a&&(a.previous=r),n.first==i&&(n.first=a),n.last==i&&(n.last=r),u?n.size--:t.size--}return!!i},forEach:function(e){var t,n=f(this),i=s(e,arguments.length>1?arguments[1]:void 0,3);while(t=t?t.next:n.first){i(t.value,t.key,this);while(t&&t.removed)t=t.previous}},has:function(e){return!!m(this,e)}}),r(d.prototype,n?{get:function(e){var t=m(this,e);return t&&t.value},set:function(e,t){return b(this,0===e?0:e,t)}}:{add:function(e){return b(this,e=0===e?0:e,e)}}),u&&i(d.prototype,"size",{get:function(){return f(this).size}}),d},setStrong:function(e,t,n){var i=t+" Iterator",a=p(t),r=p(i);l(e,t,(function(e,t){v(this,{type:i,target:e,state:a(e),kind:t,last:void 0})}),(function(){var e=r(this),t=e.kind,n=e.last;while(n&&n.removed)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),d(t)}}},"6d61":function(e,t,n){"use strict";var i=n("23e7"),a=n("da84"),r=n("94ca"),s=n("6eeb"),o=n("f183"),c=n("2266"),l=n("19aa"),d=n("861d"),u=n("d039"),h=n("1c7e"),f=n("d44e"),v=n("7156");e.exports=function(e,t,n){var p=-1!==e.indexOf("Map"),b=-1!==e.indexOf("Weak"),m=p?"set":"add",g=a[e],y=g&&g.prototype,x=g,w={},_=function(e){var t=y[e];s(y,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(b&&!d(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return b&&!d(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(b&&!d(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})},C=r(e,"function"!=typeof g||!(b||y.forEach&&!u((function(){(new g).entries().next()}))));if(C)x=n.getConstructor(t,e,p,m),o.REQUIRED=!0;else if(r(e,!0)){var E=new x,k=E[m](b?{}:-0,1)!=E,A=u((function(){E.has(1)})),B=h((function(e){new g(e)})),S=!b&&u((function(){var e=new g,t=5;while(t--)e[m](t,t);return!e.has(-0)}));B||(x=t((function(t,n){l(t,x,e);var i=v(new g,t,x);return void 0!=n&&c(n,i[m],{that:i,AS_ENTRIES:p}),i})),x.prototype=y,y.constructor=x),(A||S)&&(_("delete"),_("has"),p&&_("get")),(S||k)&&_(m),b&&y.clear&&delete y.clear}return w[e]=x,i({global:!0,forced:x!=g},w),f(x,e),b||n.setStrong(x,e,p),x}},a573:function(e,t,n){"use strict";var i=n("23e7"),a=n("1c0b"),r=n("825a"),s=n("c5cc"),o=n("9bdd"),c=s((function(e){var t=this.iterator,n=r(this.next.call(t,e)),i=this.done=!!n.done;if(!i)return o(t,this.mapper,n.value)}));i({target:"Iterator",proto:!0,real:!0},{map:function(e){return new c({iterator:r(this),mapper:a(e)})}})},addb:function(e,t){var n=Math.floor,i=function(e,t){var s=e.length,o=n(s/2);return s<8?a(e,t):r(i(e.slice(0,o),t),i(e.slice(o),t),t)},a=function(e,t){var n,i,a=e.length,r=1;while(r<a){i=r,n=e[r];while(i&&t(e[i-1],n)>0)e[i]=e[--i];i!==r++&&(e[i]=n)}return e},r=function(e,t,n){var i=e.length,a=t.length,r=0,s=0,o=[];while(r<i||s<a)r<i&&s<a?o.push(n(e[r],t[s])<=0?e[r++]:t[s++]):o.push(r<i?e[r++]:t[s++]);return o};e.exports=i},bb2f:function(e,t,n){var i=n("d039");e.exports=!i((function(){return Object.isExtensible(Object.preventExtensions({}))}))},d81d:function(e,t,n){"use strict";var i=n("23e7"),a=n("b727").map,r=n("1dde"),s=r("map");i({target:"Array",proto:!0,forced:!s},{map:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}})},d998:function(e,t,n){var i=n("342f");e.exports=/MSIE|Trident/.test(i)},f183:function(e,t,n){var i=n("d012"),a=n("861d"),r=n("5135"),s=n("9bf2").f,o=n("90e3"),c=n("bb2f"),l=o("meta"),d=0,u=Object.isExtensible||function(){return!0},h=function(e){s(e,l,{value:{objectID:"O"+ ++d,weakData:{}}})},f=function(e,t){if(!a(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!r(e,l)){if(!u(e))return"F";if(!t)return"E";h(e)}return e[l].objectID},v=function(e,t){if(!r(e,l)){if(!u(e))return!0;if(!t)return!1;h(e)}return e[l].weakData},p=function(e){return c&&b.REQUIRED&&u(e)&&!r(e,l)&&h(e),e},b=e.exports={REQUIRED:!1,fastKey:f,getWeakData:v,onFreeze:p};i[l]=!0},f2c3:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-container",{attrs:{fluid:""}},[n("b-col",[n("b-row",{staticClass:"my-1",attrs:{"align-h":"center"}},[n("div",{staticClass:"wrapper"},[e._v("\n        Confidence Threshold"),n("br"),n("input",{attrs:{type:"range",value:"90",min:"55",max:"99",step:"1"},on:{click:e.updateConfidence}}),e._v("\n        "+e._s(e.Confidence)+"%"),n("br")])]),!0===e.lowerConfidence?n("div",[e._v("\n      "+e._s(e.lowerConfidenceMessage)+"\n    ")]):e._e(),e.isBusy?n("div",{staticClass:"wrapper"},[n("Loading")],1):e._e(),n("b-row",{staticClass:"my-1",attrs:{"align-h":"center"}},[n("div",{staticClass:"wrapper"},[n("br"),e._l(e.sorted_unique_labels,(function(t){return[e.boxes_available.includes(t[0])?[n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{variant:"outline-dark",title:t[1],size:"sm",pill:""},on:{click:function(n){return e.updateMarkers(t[0])}}},[e._v("\n              "+e._s(t[0]+"*")+"\n            ")]),e._v("  \n          ")]:[n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{variant:"outline-secondary",title:t[1],size:"sm",pill:""},on:{click:function(n){return e.updateMarkers(t[0])}}},[e._v("\n              "+e._s(t[0])+"\n            ")]),e._v("  \n          ")]]}))],2)]),n("b-row",{staticClass:"my-1",attrs:{"align-h":"center"}},[!1===e.isBusy?n("div",{staticClass:"wrapper"},[n("br"),n("p",{staticClass:"text-muted"},[e._v("\n          ("+e._s(e.count_labels)+" identified objects, "+e._s(e.count_distinct_labels)+" unique)\n        ")]),n("hr"),n("p",{staticClass:"text-muted"},[e._v("\n          * Indicates bounding boxes are available.\n        ")])]):e._e()])],1),n("b-button",{attrs:{type:"button"},on:{click:function(t){return e.saveFile()}}},[e._v("\n    Download Data\n  ")]),n("br"),n("b-button",{staticClass:"text-decoration-none",attrs:{pressed:!1,size:"sm",variant:"link"},on:{click:function(t){e.showElasticsearchApiRequest=!0}}},[e._v("\n    Show API request to get these results\n  ")]),n("b-modal",{attrs:{scrollable:"",title:"SEARCH API","ok-only":""},model:{value:e.showElasticsearchApiRequest,callback:function(t){e.showElasticsearchApiRequest=t},expression:"showElasticsearchApiRequest"}},[n("label",[e._v("Request URL:")]),n("pre",{directives:[{name:"highlightjs",rawName:"v-highlightjs"}]},[n("code",{staticClass:"bash"},[e._v("GET "+e._s(e.SEARCH_ENDPOINT)+"workflow/execution")])]),n("label",[e._v("Search query:")]),n("pre",{directives:[{name:"highlightjs",rawName:"v-highlightjs",value:JSON.stringify(e.searchQuery),expression:"JSON.stringify(searchQuery)"}]},[n("code",{staticClass:"json"})]),n("label",[e._v("Sample command:")]),n("pre",{directives:[{name:"highlightjs",rawName:"v-highlightjs",value:e.curlCommand,expression:"curlCommand"}]},[n("code",{staticClass:"bash"})])])],1)},a=[],r=n("c14f"),s=n("1da1"),o=n("2909"),c=n("5530"),l=(n("4de4"),n("a630"),n("caad"),n("a15b"),n("d81d"),n("fb6a"),n("4e82"),n("b0c0"),n("e9c4"),n("4ec9"),n("b680"),n("b64b"),n("d3b7"),n("2532"),n("3ca3"),n("0643"),n("2382"),n("4e3e"),n("a573"),n("159b"),n("ddb0"),n("2b3d"),n("bf19"),n("9861"),n("2f62")),d=n("3a5e"),u={name:"Celebrities",components:{Loading:d["a"]},props:{mediaType:{type:String,default:""}},data:function(){return{curlCommand:"",searchQuery:"",showElasticsearchApiRequest:!1,Confidence:90,high_confidence_data:[],elasticsearch_data:[],boxes_available:[],count_distinct_labels:0,count_labels:0,isBusy:!1,operator:"celebrity_detection",canvasRefreshInterval:void 0,timeseries:new Map,selectedLabel:"",lowerConfidence:!1,lowerConfidenceMessage:"Try lowering confidence threshold"}},computed:Object(c["a"])(Object(c["a"])({},Object(l["b"])(["player"])),{},{sorted_unique_labels:function(){var e=this.elasticsearch_data,t=new Map;e.forEach(function(e){t.set(e.Name,t.get(e.Name)?t.get(e.Name)+1:1),e.BoundingBox&&this.saveBoxedLabel(e.Name)}.bind(this));var n=new Map(Object(o["a"])(t.entries()).slice().sort((function(e,t){return t[1]-e[1]})));return n.delete(void 0),this.countLabels(n.size,e.length),n}}),watch:{selectedLabel:function(){this.chartData()},elasticsearch_data:function(){this.chartData()}},deactivated:function(){console.log("deactivated component:",this.operator),this.boxes_available=[],this.selectedLabel="",clearInterval(this.canvasRefreshInterval);var e=document.getElementById("canvas");if(e)var t=e.getContext("2d");t&&t.clearRect(0,0,e.width,e.height)},activated:function(){console.log("activated component:",this.operator),this.fetchAssetData()},mounted:function(){this.getCurlCommand()},beforeDestroy:function(){this.high_confidence_data=[],this.elasticsearch_data=[],this.count_distinct_labels=0,this.count_labels=0,clearInterval(this.canvasRefreshInterval)},methods:{getCurlCommand:function(){this.searchQuery="AssetId:"+this.$route.params.asset_id+" Confidence:>"+this.Confidence+" Operator:"+this.operator,this.curlCommand="awscurl -X GET --profile default --service es --region "+this.AWS_REGION+" '"+this.SEARCH_ENDPOINT+"/_search?q="+encodeURIComponent(this.searchQuery)+"'"},saveBoxedLabel:function(e){this.boxes_available.includes(e)||this.boxes_available.push(e)},countLabels:function(e,t){this.count_distinct_labels=e,this.count_labels=t},saveFile:function(){var e=this.elasticsearch_data,t=new Blob([JSON.stringify(e)],{type:"text/plain"}),n=document.createEvent("MouseEvents"),i=document.createElement("a");i.download="data.json",i.href=window.URL.createObjectURL(t),i.dataset.downloadurl=["text/json",i.download,i.href].join(":"),n.initEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(n)},updateConfidence:function(e){this.isBusy=!this.isBusy,this.Confidence=e.target.value,"video"===this.mediaType&&this.player.markers.removeAll(),this.getCurlCommand(),this.fetchAssetData()},updateMarkers:function(e){this.boxes_available=[],clearInterval(this.canvasRefreshInterval);var t=document.getElementById("canvas"),n=t.getContext("2d");if(n.clearRect(0,0,t.width,t.height),n.strokeStyle="red",n.font="15px Arial",n.textAlign="center",n.textBaseline="middle",n.fillStyle="red",this.selectedLabel!==e){this.selectedLabel=e;var i=new Map,a=[],r=this.elasticsearch_data,s=0;r.forEach(function(n){if(n.Name===e&&(a.push({time:n.Timestamp/1e3,text:n.Name,overlayText:n.Name}),n.BoundingBox))if("image"===this.mediaType){var r={instance:s,name:n.Name,confidence:(1*n.Confidence).toFixed(2),x:n.BoundingBox.Left*t.width,y:n.BoundingBox.Top*t.height,width:n.BoundingBox.Width*t.width,height:n.BoundingBox.Height*t.height};i.set(s++,[r])}else{var o=Math.round(n.Timestamp/100),c={instance:0,timestamp:Math.ceil(n.Timestamp/100),name:n.Name,confidence:(1*n.Confidence).toFixed(2),x:n.BoundingBox.Left*t.width,y:n.BoundingBox.Top*t.height,width:n.BoundingBox.Width*t.width,height:n.BoundingBox.Height*t.height};i.set(o,[c])}}.bind(this)),i.size>0&&this.drawBoxes(i),"video"===this.mediaType&&(this.player.markers.removeAll(),this.player.markers.add(a))}else this.selectedLabel=""},fetchAssetData:function(){var e=this;return Object(s["a"])(Object(r["a"])().m((function t(){var n,i,a,s,o,c,l,d,u;return Object(r["a"])().w((function(t){while(1)switch(t.n){case 0:return n="contentAnalysisElasticsearch",i="/_search",a={headers:{"Content-Type":"application/json"},queryStringParameters:{q:e.searchQuery,default_operator:"AND",size:1e4}},t.n=1,e.$Amplify.API.get(n,i,a);case 1:if(s=t.v,s){t.n=2;break}e.showElasticSearchAlert=!0,t.n=4;break;case 2:return o=[],t.n=3,s;case 3:if(c=t.v,l=c.hits.hits,0===l.length&&e.Confidence>55)e.lowerConfidence=!0,e.lowerConfidenceMessage="Try lowering confidence threshold";else for(e.lowerConfidence=!1,d=0,u=l.length;d<u;d++)o.push(l[d]._source);e.elasticsearch_data=JSON.parse(JSON.stringify(o)),e.isBusy=!1;case 4:return t.a(2)}}),t)})))()},drawBoxes:function(e){var t=document.getElementById("canvas"),n=t.getContext("2d");if("image"===this.mediaType)return n.clearRect(0,0,t.width,t.height),n.beginPath(),n.strokeStyle="red",n.font="15px Arial",n.textAlign="center",n.textBaseline="middle",n.fillStyle="red",void e.forEach((function(e){var t=e[0];t&&(n.rect(t.x,t.y,t.width,t.height),n.fillText(t.name+" ("+t.confidence+"%)",t.x+t.width/2,t.y-10),n.stroke())}));void 0!==this.canvasRefreshInterval&&clearInterval(this.canvasRefreshInterval);var i=100,a=2,r=0;this.canvasRefreshInterval=setInterval(function(){r++,this.player.paused()||r%a!==0||(r=0,n.clearRect(0,0,t.width,t.height),n.beginPath(),n.strokeStyle="red",n.font="15px Arial",n.textAlign="center",n.textBaseline="middle",n.fillStyle="red");var i=Math.round(10*this.player.currentTime());if(e.has(i)){r=0,n.clearRect(0,0,t.width,t.height),n.beginPath(),n.strokeStyle="red",n.font="15px Arial",n.textAlign="center",n.textBaseline="middle",n.fillStyle="red";var s=e.get(i).map((function(e){return e.instance})).filter((function(e,t,n){return n.indexOf(e)===t}));s.forEach((function(t){var a=e.get(i).filter((function(e){return e.instance===t}));a.forEach((function(e){e&&(n.rect(e.x,e.y,e.width,e.height),n.fillText(e.name+" ("+e.confidence+"%)",e.x+e.width/2,e.y-10))}))})),n.stroke()}}.bind(this),i)},chartData:function(){var e=new Map;function t(t){e.has(t)?e.set(t,{x:t,y:e.get(t).y+1}):e.set(t,{x:t,y:1})}var n=this.elasticsearch_data;n.forEach(function(e){var n=Math.round(e.Timestamp);this.selectedLabel?e.Name===this.selectedLabel&&t(n):t(n)}.bind(this));var i=new Map(Object(o["a"])(e.entries()).slice().sort((function(e,t){return e[0]-t[0]}))),a=Array.from(i.values());this.$store.commit("updateTimeseries",a),this.$store.commit("updateSelectedLabel",this.selectedLabel)}}},h=u,f=n("2877"),v=Object(f["a"])(h,i,a,!1,null,null,null);t["default"]=v.exports}}]);
//# sourceMappingURL=chunk-1d10fd4a.0e36bf4c.js.map